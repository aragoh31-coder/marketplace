{% extends "base_tor_safe.html" %}
{% load static %}

{% block title %}{{ page_title }}{% endblock %}

{% block content %}
<div class="analytics-dashboard">
    <div class="dashboard-header">
        <h1>Vendor Analytics Dashboard</h1>
        <p>Comprehensive insights into your business performance</p>
    </div>

    <!-- Summary Metrics -->
    <div class="summary-section">
        <div class="metric-card">
            <div class="metric-icon">üí∞</div>
            <div class="metric-info">
                <h3>Total Revenue</h3>
                <div class="metric-value">${{ dashboard_data.summary_metrics.total_revenue|floatformat:2 }}</div>
                <div class="metric-change {% if dashboard_data.summary_metrics.revenue_growth >= 0 %}positive{% else %}negative{% endif %}">
                    {% if dashboard_data.summary_metrics.revenue_growth >= 0 %}‚Üó{% else %}‚Üò{% endif %}
                    {{ dashboard_data.summary_metrics.revenue_growth|floatformat:1 }}%
                </div>
            </div>
        </div>

        <div class="metric-card">
            <div class="metric-icon">üì¶</div>
            <div class="metric-info">
                <h3>Total Orders</h3>
                <div class="metric-value">{{ dashboard_data.summary_metrics.total_orders }}</div>
                <div class="metric-change {% if dashboard_data.summary_metrics.order_growth >= 0 %}positive{% else %}negative{% endif %}">
                    {% if dashboard_data.summary_metrics.order_growth >= 0 %}‚Üó{% else %}‚Üò{% endif %}
                    {{ dashboard_data.summary_metrics.order_growth|floatformat:1 }}%
                </div>
            </div>
        </div>

        <div class="metric-card">
            <div class="metric-icon">üë•</div>
            <div class="metric-info">
                <h3>Active Customers</h3>
                <div class="metric-value">{{ dashboard_data.summary_metrics.active_customers }}</div>
                <div class="metric-change {% if dashboard_data.summary_metrics.customer_growth >= 0 %}positive{% else %}negative{% endif %}">
                    {% if dashboard_data.summary_metrics.customer_growth >= 0 %}‚Üó{% else %}‚Üò{% endif %}
                    {{ dashboard_data.summary_metrics.customer_growth|floatformat:1 }}%
                </div>
            </div>
        </div>

        <div class="metric-card">
            <div class="metric-icon">‚≠ê</div>
            <div class="metric-info">
                <h3>Average Rating</h3>
                <div class="metric-value">{{ dashboard_data.summary_metrics.average_rating|floatformat:1 }}/5.0</div>
                <div class="metric-change {% if dashboard_data.summary_metrics.rating_change >= 0 %}positive{% else %}negative{% endif %}">
                    {% if dashboard_data.summary_metrics.rating_change >= 0 %}‚Üó{% else %}‚Üò{% endif %}
                    {{ dashboard_data.summary_metrics.rating_change|floatformat:1 }}
                </div>
            </div>
        </div>
    </div>

    <!-- Sales Performance -->
    <div class="chart-section">
        <h2>Sales Performance</h2>
        <div class="chart-container">
            <div class="chart-item">
                <h3>Daily Sales</h3>
                <div class="chart-data">
                    {% for day, amount in dashboard_data.sales_performance.daily_sales.items %}
                    <div class="chart-bar">
                        <div class="bar-fill" style="height: {{ amount|floatformat:0 }}px;"></div>
                        <div class="bar-label">{{ day }}</div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            
            <div class="chart-item">
                <h3>Top Products</h3>
                <div class="product-list">
                    {% for product in dashboard_data.product_performance.top_products %}
                    <div class="product-item">
                        <div class="product-name">{{ product.name }}</div>
                        <div class="product-sales">{{ product.sales_count }} sales</div>
                        <div class="product-revenue">${{ product.revenue|floatformat:2 }}</div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <!-- Customer Insights -->
    <div class="insights-section">
        <h2>Customer Insights</h2>
        <div class="insights-grid">
            <div class="insight-card">
                <h3>Customer Segments</h3>
                <div class="segment-list">
                    {% for segment in dashboard_data.customer_insights.segments %}
                    <div class="segment-item">
                        <div class="segment-name">{{ segment.name }}</div>
                        <div class="segment-count">{{ segment.count }} customers</div>
                        <div class="segment-percentage">{{ segment.percentage|floatformat:1 }}%</div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <div class="insight-card">
                <h3>Geographic Distribution</h3>
                <div class="geo-list">
                    {% for location in dashboard_data.geographic_insights.top_locations %}
                    <div class="geo-item">
                        <div class="geo-name">{{ location.name }}</div>
                        <div class="geo-orders">{{ location.orders }} orders</div>
                        <div class="geo-revenue">${{ location.revenue|floatformat:2 }}</div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <!-- Quality Metrics -->
    <div class="quality-section">
        <h2>Quality Metrics</h2>
        <div class="quality-grid">
            <div class="quality-card">
                <h3>Dispute Rate</h3>
                <div class="quality-value">{{ dashboard_data.quality_metrics.dispute_rate|floatformat:2 }}%</div>
                <div class="quality-description">Lower is better</div>
            </div>

            <div class="quality-card">
                <h3>Resolution Time</h3>
                <div class="quality-value">{{ dashboard_data.quality_metrics.avg_resolution_time|floatformat:1 }} days</div>
                <div class="quality-description">Lower is better</div>
            </div>

            <div class="quality-card">
                <h3>Customer Satisfaction</h3>
                <div class="quality-value">{{ dashboard_data.quality_metrics.satisfaction_score|floatformat:1 }}/10</div>
                <div class="quality-description">Higher is better</div>
            </div>

            <div class="quality-card">
                <h3>Return Rate</h3>
                <div class="quality-value">{{ dashboard_data.quality_metrics.return_rate|floatformat:2 }}%</div>
                <div class="quality-description">Lower is better</div>
            </div>
        </div>
    </div>

    <!-- Trend Analysis -->
    <div class="trends-section">
        <h2>Trend Analysis</h2>
        <div class="trends-grid">
            <div class="trend-card">
                <h3>Revenue Trends</h3>
                <div class="trend-description">
                    {% if dashboard_data.trend_analysis.revenue_trend == 'increasing' %}
                        üìà Revenue is trending upward
                    {% elif dashboard_data.trend_analysis.revenue_trend == 'decreasing' %}
                        üìâ Revenue is trending downward
                    {% else %}
                        ‚û°Ô∏è Revenue is stable
                    {% endif %}
                </div>
                <div class="trend-factors">
                    <h4>Key Factors:</h4>
                    <ul>
                        {% for factor in dashboard_data.trend_analysis.revenue_factors %}
                        <li>{{ factor }}</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>

            <div class="trend-card">
                <h3>Customer Behavior</h3>
                <div class="trend-description">
                    {% if dashboard_data.trend_analysis.customer_trend == 'growing' %}
                        üë• Customer base is growing
                    {% elif dashboard_data.trend_analysis.customer_trend == 'declining' %}
                        üë• Customer base is declining
                    {% else %}
                        üë• Customer base is stable
                    {% endif %}
                </div>
                <div class="trend-factors">
                    <h4>Key Factors:</h4>
                    <ul>
                        {% for factor in dashboard_data.trend_analysis.customer_factors %}
                        <li>{{ factor }}</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Recommendations -->
    <div class="recommendations-section">
        <h2>Actionable Recommendations</h2>
        <div class="recommendations-list">
            {% for recommendation in dashboard_data.recommendations %}
            <div class="recommendation-item">
                <div class="recommendation-priority {{ recommendation.priority }}">
                    {{ recommendation.priority|title }}
                </div>
                <div class="recommendation-content">
                    <h4>{{ recommendation.title }}</h4>
                    <p>{{ recommendation.description }}</p>
                    <div class="recommendation-impact">
                        <strong>Expected Impact:</strong> {{ recommendation.expected_impact }}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="actions-section">
        <h2>Quick Actions</h2>
        <div class="action-buttons">
            <a href="{% url 'core:product_recommendations' %}" class="btn btn-primary">View Product Recommendations</a>
            <a href="{% url 'core:price_predictions' %}" class="btn btn-secondary">Check Price Predictions</a>
            <a href="{% url 'core:system_insights' %}" class="btn btn-secondary">View System Insights</a>
        </div>
    </div>
</div>

<style>
.analytics-dashboard {
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
}

.dashboard-header {
    text-align: center;
    margin-bottom: 40px;
}

.dashboard-header h1 {
    color: #2c3e50;
    margin-bottom: 10px;
}

.dashboard-header p {
    color: #7f8c8d;
    font-size: 18px;
}

.summary-section {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 40px;
}

.metric-card {
    background: white;
    border-radius: 12px;
    padding: 25px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    display: flex;
    align-items: center;
    gap: 20px;
}

.metric-icon {
    font-size: 36px;
    width: 60px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #f8f9fa;
    border-radius: 50%;
}

.metric-info h3 {
    margin: 0 0 10px 0;
    color: #2c3e50;
    font-size: 16px;
}

.metric-value {
    font-size: 28px;
    font-weight: bold;
    color: #2c3e50;
    margin-bottom: 5px;
}

.metric-change {
    font-size: 14px;
    font-weight: bold;
}

.metric-change.positive {
    color: #27ae60;
}

.metric-change.negative {
    color: #e74c3c;
}

.chart-section {
    background: white;
    border-radius: 12px;
    padding: 30px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    margin-bottom: 40px;
}

.chart-section h2 {
    color: #2c3e50;
    margin-bottom: 25px;
}

.chart-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
}

.chart-item h3 {
    color: #2c3e50;
    margin-bottom: 20px;
}

.chart-data {
    display: flex;
    align-items: end;
    gap: 10px;
    height: 200px;
    padding: 20px 0;
}

.chart-bar {
    display: flex;
    flex-direction: column;
    align-items: center;
    flex: 1;
}

.bar-fill {
    background: linear-gradient(to top, #3498db, #2980b9);
    width: 30px;
    border-radius: 4px 4px 0 0;
    min-height: 10px;
}

.bar-label {
    margin-top: 10px;
    font-size: 12px;
    color: #7f8c8d;
    text-align: center;
}

.product-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.product-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
}

.product-name {
    font-weight: bold;
    color: #2c3e50;
    flex: 1;
}

.product-sales {
    color: #7f8c8d;
    margin: 0 15px;
}

.product-revenue {
    font-weight: bold;
    color: #27ae60;
}

.insights-section {
    background: white;
    border-radius: 12px;
    padding: 30px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    margin-bottom: 40px;
}

.insights-section h2 {
    color: #2c3e50;
    margin-bottom: 25px;
}

.insights-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
}

.insight-card h3 {
    color: #2c3e50;
    margin-bottom: 20px;
}

.segment-list, .geo-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.segment-item, .geo-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px;
    background: #f8f9fa;
    border-radius: 6px;
}

.segment-name, .geo-name {
    font-weight: bold;
    color: #2c3e50;
    flex: 1;
}

.segment-count, .geo-orders {
    color: #7f8c8d;
    margin: 0 15px;
}

.segment-percentage, .geo-revenue {
    font-weight: bold;
    color: #27ae60;
}

.quality-section {
    background: white;
    border-radius: 12px;
    padding: 30px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    margin-bottom: 40px;
}

.quality-section h2 {
    color: #2c3e50;
    margin-bottom: 25px;
    text-align: center;
}

.quality-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
}

.quality-card {
    text-align: center;
    padding: 25px;
    border-radius: 8px;
    border: 2px solid #ecf0f1;
}

.quality-card h3 {
    color: #2c3e50;
    margin-bottom: 15px;
    font-size: 16px;
}

.quality-value {
    font-size: 24px;
    font-weight: bold;
    color: #3498db;
    margin-bottom: 10px;
}

.quality-description {
    font-size: 14px;
    color: #7f8c8d;
}

.trends-section {
    background: white;
    border-radius: 12px;
    padding: 30px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    margin-bottom: 40px;
}

.trends-section h2 {
    color: #2c3e50;
    margin-bottom: 25px;
}

.trends-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
}

.trend-card {
    padding: 25px;
    background: #f8f9fa;
    border-radius: 8px;
}

.trend-card h3 {
    color: #2c3e50;
    margin-bottom: 15px;
}

.trend-description {
    font-size: 18px;
    margin-bottom: 20px;
    padding: 15px;
    background: white;
    border-radius: 6px;
    text-align: center;
}

.trend-factors h4 {
    color: #2c3e50;
    margin-bottom: 10px;
}

.trend-factors ul {
    list-style: none;
    padding: 0;
}

.trend-factors li {
    padding: 8px 0;
    border-bottom: 1px solid #ecf0f1;
    color: #7f8c8d;
}

.trend-factors li:last-child {
    border-bottom: none;
}

.recommendations-section {
    background: white;
    border-radius: 12px;
    padding: 30px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    margin-bottom: 40px;
}

.recommendations-section h2 {
    color: #2c3e50;
    margin-bottom: 25px;
}

.recommendations-list {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.recommendation-item {
    display: flex;
    gap: 20px;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 8px;
    border-left: 4px solid #3498db;
}

.recommendation-priority {
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: bold;
    text-transform: uppercase;
    align-self: flex-start;
}

.recommendation-priority.high {
    background: #e74c3c;
    color: white;
}

.recommendation-priority.medium {
    background: #f39c12;
    color: white;
}

.recommendation-priority.low {
    background: #27ae60;
    color: white;
}

.recommendation-content {
    flex: 1;
}

.recommendation-content h4 {
    color: #2c3e50;
    margin-bottom: 10px;
}

.recommendation-content p {
    color: #7f8c8d;
    margin-bottom: 15px;
    line-height: 1.6;
}

.recommendation-impact {
    font-size: 14px;
    color: #2c3e50;
}

.actions-section {
    background: white;
    border-radius: 12px;
    padding: 30px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    text-align: center;
}

.actions-section h2 {
    color: #2c3e50;
    margin-bottom: 20px;
}

.action-buttons {
    display: flex;
    gap: 15px;
    justify-content: center;
    flex-wrap: wrap;
}

.btn {
    display: inline-block;
    padding: 12px 24px;
    border-radius: 6px;
    text-decoration: none;
    font-weight: bold;
    transition: all 0.3s ease;
}

.btn-primary {
    background: #3498db;
    color: white;
}

.btn-primary:hover {
    background: #2980b9;
}

.btn-secondary {
    background: #95a5a6;
    color: white;
}

.btn-secondary:hover {
    background: #7f8c8d;
}

@media (max-width: 768px) {
    .summary-section {
        grid-template-columns: 1fr;
    }
    
    .chart-container {
        grid-template-columns: 1fr;
    }
    
    .insights-grid {
        grid-template-columns: 1fr;
    }
    
    .trends-grid {
        grid-template-columns: 1fr;
    }
    
    .quality-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .action-buttons {
        flex-direction: column;
        align-items: center;
    }
    
    .btn {
        width: 100%;
        max-width: 300px;
    }
}
</style>
{% endblock %}