{% extends "base_tor_safe.html" %}
{% block title %}Vendor Orders{% endblock %}
{% block content %}
<div class="container">
    <h1>Orders</h1>
    
    <!-- Order Status Filter -->
    <div class="filters">
        <a href="{% url 'vendors:orders' %}" 
           class="filter-btn {% if not request.GET.status %}active{% endif %}">All</a>
        <a href="?status=paid" 
           class="filter-btn {% if request.GET.status == 'paid' %}active{% endif %}">Paid</a>
        <a href="?status=shipped" 
           class="filter-btn {% if request.GET.status == 'shipped' %}active{% endif %}">Shipped</a>
        <a href="?status=completed" 
           class="filter-btn {% if request.GET.status == 'completed' %}active{% endif %}">Completed</a>
    </div>
    
    <!-- Orders Table -->
    <div class="orders-table">
        <table class="table">
            <thead>
                <tr>
                    <th>Order #</th>
                    <th>Date</th>
                    <th>Buyer</th>
                    <th>Products</th>
                    <th>Total</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for order in page_obj %}
                <tr>
                    <td>#{{ order.id }}</td>
                    <td>{{ order.created_at|date:"Y-m-d H:i" }}</td>
                    <td>{{ order.user.username }}</td>
                    <td>
                        {% for item in order.items.all %}
                            {% if item.product.vendor == vendor %}
                                {{ item.product.name }} (x{{ item.quantity }})<br>
                            {% endif %}
                        {% endfor %}
                    </td>
                    <td>
                        {% if order.total_btc > 0 %}
                            ₿ {{ order.total_btc|floatformat:8 }}
                        {% else %}
                            ɱ {{ order.total_xmr|floatformat:4 }}
                        {% endif %}
                    </td>
                    <td>
                        <span class="status-badge status-{{ order.status }}">
                            {{ order.get_status_display }}
                        </span>
                    </td>
                    <td>
                        <a href="{% url 'vendors:order_detail' order.id %}" class="btn btn-sm">
                            View
                        </a>
                        {% if order.status == 'paid' %}
                            <form method="post" action="{% url 'vendors:ship_order' order.id %}" 
                                  style="display:inline;">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-sm btn-primary">Ship</button>
                            </form>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="7" class="text-center">No orders found.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <!-- Pagination -->
    {% if page_obj.has_other_pages %}
    <div class="pagination">
        {% if page_obj.has_previous %}
            <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}" 
               class="btn btn-sm">Previous</a>
        {% endif %}
        
        <span class="page-info">
            Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
        </span>
        
        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}" 
               class="btn btn-sm">Next</a>
        {% endif %}
    </div>
    {% endif %}
</div>

<style>
    .filters {
        display: flex;
        gap: 10px;
        margin-bottom: 30px;
    }
    
    .filter-btn {
        padding: 8px 16px;
        background: #2a2a2a;
        color: #fff;
        text-decoration: none;
        border-radius: 5px;
        transition: background 0.3s;
    }
    
    .filter-btn:hover {
        background: #333;
    }
    
    .filter-btn.active {
        background: #4CAF50;
    }
</style>
{% endblock %}
